---
title: "combine combustion data by project (FISL, LC, LCC"
author: "Anna Talucci"
date: "2025-06-06"
output: html_document
---
```{r clear environment, include=FALSE}
rm(list=ls())
```

# Overview
**Updated 8-29-2025**
Combine CSV files at project level for combustion model and for day of burn data.

**Updated 10-03-2025**
Rerun FISL and LC at site level

Variables
Soil
Terrain
TWI
Climate Normals
fwi
Indices

Processing by Project.

# Packages 

```{r}
library(tidyverse)
library(sf)
```

# Functions 

## To combine data

```{r}
join_df_fun <- function(df, soil, terrain, twi, cna, fwi, index, tc, landcover){df %>% 
  full_join(soil, by="ID") %>%
  full_join(terrain, by="ID") %>%
  full_join(twi, by="ID") %>%
  full_join(cna, by="ID") %>%
  full_join(fwi, by="ID")%>%
  full_join(index, by="ID") %>%
    full_join(tc, by="ID") %>%
   full_join(landcover, by="ID") %>%
    select(-contains(c("_at", "_sm", "_sp", "_wt"))) %>%
    select(-any_of(c("SHM", "TD"))) %>%
    select(-contains(".y")) 
}
```

# FISL

## Load CSV files by project

```{r}
fisl = read_csv("../outputs/LCC_cleaned/csv/2025-09-30_FISL_Site_fullCombustionID.csv")
```

```{r}
fisl_soil = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_Soil_FISL.csv")

fisl_terrain = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_FISL_Terrain.csv")
fisl_tc = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_TreeCover_FISL.csv")
fisl_twi = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_FISL_TWI.csv")
fisl_cna = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_Fisl_site_ClimateNormals.csv")
fisl_fwi = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_Fisl_site_fwi.csv")
fisl_index = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_FISL_Indices.csv")
fisl_landcover = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_FISL_LandCover.csv")
```

## View Data

```{r}
( fisl1 = fisl %>% rename(ID = site_ID) )
fisl_soil 
fisl_terrain  
fisl_twi 
fisl_cna  
( fisl_fwi1 = fisl_fwi %>% select(-fireYr) )
fisl_index
fisl_landcover
```

## Apply Join Function

```{r}
( fisl_df = join_df_fun(fisl1, fisl_soil, fisl_terrain, fisl_twi, fisl_cna, fisl_fwi1, fisl_index, fisl_tc, fisl_landcover))

```

## Check NA

```{r}
fisl_df %>% filter(if_any(everything(), is.na))
```

# Save project DF

```{r}
write_csv(fisl_df, "../outputs/2025-08-31_Cleaned_DF/2025-10-03_FISL_Site_Predictors.csv")
```

# LC 

```{r}
lc = read_csv("../outputs/LCC_cleaned/csv/2025-09-30_LC_Site_fullCombustionID.csv")
```

```{r}
lc_soil = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-03_Soil_LC.csv")
lc_terrain = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-03_LC_Terrain.csv")
lc_tc = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-03_TreeCover_LC.csv")
lc_twi = read_csv( "../outputs/2025-08-18_cleaned/csv/2025-10-03_LC_TWI.csv")
lc_cna = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-02_LC_site_ClimateNormals.csv")
lc_fwi = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-03_LC_site_fwi.csv")
lc_index = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-03_LC_Indices.csv")
lc_landcover = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-03_LC_LandCover.csv")
```

## view data

```{r}
( lc1 = lc %>% rename(ID = site_ID) )
lc_soil 
lc_terrain  
lc_twi 
lc_cna
( lc_fwi1 = lc_fwi %>% select(-fireYr) )
```

## Apply Join Function

```{r}

( lc_df = join_df_fun(lc1, lc_soil, lc_terrain, lc_twi, lc_cna, lc_fwi1, lc_index, lc_tc, lc_landcover))

```

## Check NA

```{r}
lc_df %>% filter(if_any(everything(), is.na))
```

# Save project DF

```{r}
write_csv(lc_df,"../outputs/2025-08-31_Cleaned_DF/2025-10-03_LC_site_Predictors.csv")
```

# LCC

```{r}
lcc = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_LCC_fullCombustionID.csv")
```


```{r}
lcc_soil = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-18_Soil_LCC.csv")
lcc_terrain = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-22_LCC_Terrain.csv")
lcc_tc = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-18_TreeCover_LCC.csv")
lcc_twi = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-14_LCC_TWI.csv")
lcc_cna = read_csv("../outputs/2025-08-18_cleaned/csv/2025-08-20_LCC_ClimateNormals.csv")
lcc_fwi = read_csv("../outputs/2025-08-18_cleaned/csv/2025-10-28_LCC_fwi.csv")
lcc_index = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-18_LCC_Indices.csv")
lcc_landcover = read_csv( "../outputs/2025-08-18_cleaned/csv/2025-09-23_LCC_LandCover.csv")
```

## view LCC

```{r}
lcc
lcc_soil 
lcc_terrain  
lcc_twi 
lcc_cna 
lcc_fwi 
```

## Apply Join Function

```{r}
( lcc_df = join_df_fun(lcc, lcc_soil, lcc_terrain, lcc_twi, lcc_cna, lcc_fwi, lcc_index, lcc_tc, lcc_landcover))

```

## Check NA

```{r}
lcc_df %>% filter(if_any(everything(), is.na)) 

```

```{r}
lcc_df %>% drop_na(FWI)

```


```{r}
( lcc_df_final1 = lcc_df %>% 
  drop_na(date) %>% 
  rename(fireYr = fireYr.x) %>% 
  mutate( DOB_lst= lubridate::yday(date),
          fireYr = as.numeric(fireYr)) 
)

```


# Save project DF

```{r}
write_csv(lcc_df_final1, "../outputs/2025-08-31_Cleaned_DF/2025-10-28_LCC_Predictors.csv")
```

## ORG

```{r}
org = read_csv("../outputs/LCC_cleaned/csv/2025-08-30_ORG_fullCombustionID.csv")
```

```{r}
org_soil = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-23_Soil_ORG.csv")
org_terrain = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-22_ORG_Terrain.csv")
org_tc = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-18_TreeCover_ORG.csv")
org_twi = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-12_ORG_TWI.csv")
org_fwi = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-09_ORG_fwi.csv")
org_index = read_csv("../outputs/2025-08-18_cleaned/csv/2025-09-18_ORG_Indices.csv")
org_predictors = read_csv("../outputs/LCC_cleaned/csv/2025-08-31_ORG_Predictors.csv")
org_landcover = read_csv( "../outputs/2025-08-18_cleaned/csv/2025-09-23_ORG_LandCover.csv")
```

## view data

```{r}
names(fisl_cna)
```

```{r}
org_soil 
org_terrain 
org_twi 
org_fwi 

org_predictors 
```
PPT_at, PPT_sm, PPT_sp, PPT_wt, SHM, Tave_at, Tave_sm, Tave_sp, Tave_wt, TD, Tmax_at, Tmax_sm, Tmax_sp, Tmax_wt, Tmin_at, Tmin_sm, Tmin_sp, Tmin_wt
```{r}
org
org_soil = org_soil %>% select(-PFI)
org_pfi = org_predictors %>% select(ID, PFI)
org_fwi
org_index
org_terrain
( org_cna= org_predictors %>% 
    select(ID, contains("CNA"), -contains('5_8')) %>%
    rename_with(~ gsub("^CNA_", "", .x), starts_with("CNA_")) %>%
    select(ID, AHM, bFFP, CMD, DD_0, DD_18, DD18, DD5, eFFP, EMT, Eref, FFP, MAP, MAT, MCMT, MSP, MWMT, NFFD, PAS))
```


```{r}
( org_df1 = org %>%
  full_join(org_soil, by="ID") %>%
  full_join(org_terrain, by="ID") %>%
  full_join(org_twi, by="ID") %>%
  full_join(org_pfi, by="ID") %>%
  full_join(org_fwi, by="ID") %>%
  full_join(org_index, by="ID") %>%
    full_join(org_tc, by="ID") %>%
  full_join(org_cna, by="ID") %>%
    full_join(org_landcover, by="ID") %>%
    rename(fireYr = fireYr.x) %>%
    select(-contains(".y"), -contains(".x")) 
    
)

( org_df2 = org_df1 %>% distinct(ID, .keep_all = TRUE) )
```

## Check NA

```{r}
org_df1 %>% filter(if_any(everything(), is.na))
```

# Save project DF

```{r}
write_csv(org_df2, "../outputs/2025-08-31_Cleaned_DF/2025-09-23_ORG_Predictors.csv")
```


## check for duplicates


```{r eval=FALSE, include=FALSE}
dupes <- org_df %>% 
  filter(duplicated(ID) | duplicated(ID, fromLast = TRUE))

dupes


```




