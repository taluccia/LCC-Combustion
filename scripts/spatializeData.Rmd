---
title: "Spatialize Data"
author: "Anna Talucci"
date: "2025-04-14"
output: html_document
---

```{r clear environment, include=FALSE}
rm(list=ls())
```

# Overview

Use simplify field data that has combustion data for fisl, lc, and Org data sets.

`ExploreData.Rmd` in Repo LCC-SpatialData to generate unique row ids and subset data for field data with measured combustion values for training the combustion model. Update 8-21-25


# Packages

```{r}
library(tidyverse)  # Data manipulation & visualization
library(sf)
library(mapview)
```


# Data


```{r}
org_subset = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_ORG_subsetCombustionID.csv")
org_full = read_csv("../outputs/LCC_cleaned/csv/2025-08-30_ORG_fullCombustionID.csv")
```

```{r}
lcc_site = read_csv("../outputs/LCC_cleaned/csv/2025-10-09_LCC_fullCombustionID.csv")
```

```{r}
lc_site = read_csv("../outputs/LCC_cleaned/csv/2025-09-30_LC_Site_fullCombustionID.csv")
fisl_site = read_csv("../outputs/LCC_cleaned/csv/2025-09-30_FISL_Site_fullCombustionID.csv")
```



# Spatialize

## Function to spatialize

```{r}
df_to_sf_wgs84 <- function(x){
  st_as_sf(x, coords = c("lon","lat"), crs = 4326, remove = FALSE) # X. Walker states crs epsg:3338 but it ends up in the ocean 
}
```

```{r}
df_to_sf_NAD83 <- function(x){
  st_as_sf(x, coords = c("lon","lat"), crs = 4269, remove = FALSE) # X. Walker states crs epsg:3338 but it ends up in the ocean 
}
```

## To points

### FISL

```{r}
( fisl_full_pts_WGS84 = fisl_full %>% 
    df_to_sf_NAD83() %>%
    st_transform(., crs = 4326) %>% 
    mutate(fireYr = as.character(fireYr)) %>% 
    select(ID, project_name, lat, lon, fireYr))

```

```{r}
( fisl_site_pts_WGS84 = fisl_site %>% 
    df_to_sf_NAD83() %>%
    st_transform(., crs = 4326) %>% 
    mutate(fireYr = as.character(fireYr)) %>% 
    select(site_ID, project, lat, lon, fireYr) %>%
  rename(ID = site_ID) )

```
```{r}
sort(unique(fisl_site_pts_WGS84$fireYr))
```

### LC

```{r}
( lc_full_pts_WGS84 = lc_full %>% 
    df_to_sf_NAD83() %>% 
    st_transform(., crs = 4326) %>% 
    mutate(fireYr = as.character(fireYr)) %>% 
    select(ID, project_name, lat, lon, fireYr))
```

```{r}
( lc_site_pts_WGS84 = lc_site %>% 
    df_to_sf_NAD83() %>% 
    st_transform(., crs = 4326) %>% 
    mutate(fireYr = as.character(fireYr)) %>% 
    select(site_ID, project, lat, lon, fireYr) %>%
  rename(ID = site_ID) )
```


### LCC

```{r}
( lcc_site_pts_WGS84 = lcc_site %>%  
    df_to_sf_wgs84()  %>% 
    mutate(fireYr = as.character(fireYr)) )
```


### ORG

```{r}
( org_subset_pts_WGS84 = org_subset %>% 
    df_to_sf_wgs84() %>% 
    mutate(fireYr = as.character(fireYr)) %>% 
    select(ID, project_name, lat, lon, fireYr))

( org_full_pts_WGS84 = org_full %>% 
    df_to_sf_wgs84() %>% 
    mutate(fireYr = as.character(fireYr)) %>% 
    select(ID, project_name, lat, lon, fireYr))

```

# View points

```{r}
mapview(lc_full_pts_WGS84)
```

```{r}
mapview(lcc_site_pts_WGS84)
```

```{r}
mapview(fisl_full_pts_WGS84)
```

```{r}
mapview(org_full_pts_WGS84)
```

# Data for gpkg

```{r}
lc_full_gpkg = lc_full_pts_WGS84 %>% select(-fireYr)
lcc_full_gpkg = lcc_full_pts_WGS84 %>% select(-fireYr)
fisl_full_gpkg = fisl_full_pts_WGS84 %>% select(-fireYr)
org_full_gpkg = org_full_pts_WGS84 %>% select(-fireYr)
```



# Save Spatial Data files

## Geopackage

```{r eval=FALSE, include=FALSE}
st_write(lc_full_gpkg, "../outputs/combustion_pts_gpkg/lc_pts_WGS84_2025-08-28.gpkg")

st_write(lcc_full_gpkg, "../outputs/combustion_pts_gpkg/lcc_pts_WGS84_2025-08-28.gpkg")

st_write(fisl_full_gpkg, "../outputs/combustion_pts_gpkg/fisl_pts_WGS84_2025-08-28.gpkg")

st_write(org_full_gpkg, "../outputs/combustion_pts_gpkg/org_pts_WGS84_2025-08-28.gpkg")
```

## shapefiles

```{r eval=FALSE, include=FALSE}

st_write(fisl_site_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-10-02_fisl_site_pts_WGS84.shp", driver="ESRI Shapefile")

st_write(lc_site_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-10-03_lc_site_pts_WGS84.shp", driver="ESRI Shapefile")
```

```{r eval=FALSE, include=FALSE}
st_write(lc_full_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-29_lc_full_pts_WGS84.shp", driver="ESRI Shapefile")


st_write(fisl_full_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-29_fisl_full_pts_WGS84.shp", driver="ESRI Shapefile")

st_write(org_full_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-30_org_full_pts_WGS84.shp", driver="ESRI Shapefile")
```

```{r eval=FALSE, include=FALSE}
st_write(lcc_site_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-10-09_lcc_full_pts_WGS84.shp", driver="ESRI Shapefile")

```

## Climate NA data frames

```{r}
lc_subset
lcc_subset
fisl_subset
```

```{r}
( climateNA_lc = lc_subset %>% 
  rename(id1 = ID, id2 = fireYr, long = lon) %>%
  relocate(id1, id2) 
)

```

```{r}
( climateNA_lcc = lcc_subset %>% 
  rename(id1 = ID, id2 = fireYr, long = lon) %>%
  relocate(id1, id2) 
)

```

```{r}
( climateNA_fisl = fisl_subset %>% 
  rename(id1 = ID, id2 = fireYr, long = lon) %>%
  relocate(id1, id2) 
)

```
```{r}
write_csv(climateNA_lc, "../outputs/LCC_cleaned/csv/2025-06-02_climateNA_LC.csv")
write_csv(climateNA_lcc, "../outputs/LCC_cleaned/csv/2025-06-02_climateNA_LCC.csv")
write_csv(climateNA_fisl, "../outputs/LCC_cleaned/csv/2025-06-02_climateNA_FISL.csv")
```


