---
title: "Spatialize Data"
author: "Anna Talucci"
date: "2025-04-14"
output: html_document
---

```{r clear environment, include=FALSE}
rm(list=ls())
```

# Overview

Use simplify field data that has combustion data for fisl, lc, and Org data sets.

`ExploreData.Rmd` in Repo LCC-SpatialData to generate unique row ids and subset data for field data with measured combustion values for training the combustion model. Update 8-21-25


# Packages

```{r}
library(tidyverse)  # Data manipulation & visualization
library(sf)
library(mapview)
```


# Data


```{r}
org_subset = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_ORG_subsetCombustionID.csv")
org_full = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_ORG_fullCombustionID.csv")

lc_full = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_LC_fullCombustionID.csv")
lcc_subset = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_LCC_subsetCombustionID.csv")

lcc_full = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_LCC_fullCombustionID.csv")
fisl_full = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_FISL_fullCombustionID.csv")
```


# Spatialize

## Function to spatialize

```{r}
df_to_sf_wgs84 <- function(x){
  st_as_sf(x, coords = c("lon","lat"), crs = 4326, remove = FALSE) # X. Walker states crs epsg:3338 but it ends up in the ocean 
}
```

```{r}
df_to_sf_NAD83 <- function(x){
  st_as_sf(x, coords = c("lon","lat"), crs = 4269, remove = FALSE) # X. Walker states crs epsg:3338 but it ends up in the ocean 
}
```

## To points

```{r}
( lc_full_pts_WGS84 = lc_full %>% df_to_sf_NAD83() %>% st_transform(., crs = 4326)
)
```

```{r}
( lcc_subset_pts_WGS84 = lcc_subset %>%  df_to_sf_wgs84()  )
( lcc_full_pts_WGS84 = lcc_full %>%  df_to_sf_wgs84()  )
```

```{r}
( fisl_full_pts_WGS84 = fisl_full %>% 
    df_to_sf_NAD83() %>%
    st_transform(., crs = 4326)
)
```


```{r}
( org_subset_pts_WGS84 = org_subset %>% df_to_sf_wgs84())
( org_full_pts_WGS84 = org_full %>% df_to_sf_wgs84())

```

# View points

```{r}
mapview(lc_pts_WGS84)
```

```{r}
mapview(lcc_pts_WGS84)
```

```{r}
mapview(fisl_pts_WGS84)
```

```{r}
mapview(org_pts_WGS84)
```

# Data for gpkg

```{r}
lc_full_gpkg = lc_full_pts_WGS84 %>% select(-fireYr)
lcc_full_gpkg = lcc_full_pts_WGS84 %>% select(-fireYr)
fisl_full_gpkg = fisl_full_pts_WGS84 %>% select(-fireYr)
org_full_gpkg = org_full_pts_WGS84 %>% select(-fireYr)
```

# Fire years 


```{r}
sort(unique(fisl_pts_WGS84$fireYr))
```

# Save Spatial Data files

## Geopackage

```{r eval=FALSE, include=FALSE}
st_write(lc_full_gpkg, "../outputs/combustion_pts_gpkg/lc_pts_WGS84_2025-08-28.gpkg")

st_write(lcc_full_gpkg, "../outputs/combustion_pts_gpkg/lcc_pts_WGS84_2025-08-28.gpkg")

st_write(fisl_full_gpkg, "../outputs/combustion_pts_gpkg/fisl_pts_WGS84_2025-08-28.gpkg")

st_write(org_full_gpkg, "../outputs/combustion_pts_gpkg/org_pts_WGS84_2025-08-28.gpkg")
```

## shapefiles

```{r eval=FALSE, include=FALSE}
st_write(lc_full_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-28_lc_full_pts_WGS84.shp", driver="ESRI Shapefile")

st_write(lcc_full_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-28_lcc_full_pts_WGS84.shp", driver="ESRI Shapefile")

st_write(fisl_full_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-28_fisl_full_pts_WGS84.shp", driver="ESRI Shapefile")

st_write(org_full_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-28_org_full_pts_WGS84.shp", driver="ESRI Shapefile")
```

```{r eval=FALSE, include=FALSE}
st_write(lcc_subset_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-28_lcc_subset_pts_WGS84.shp", driver="ESRI Shapefile")

st_write(org_subset_pts_WGS84, "../outputs/LCC_cleaned/points/shapefiles/2025-08-28_org_subset_pts_WGS84.shp", driver="ESRI Shapefile")
```

## Climate NA data frames

```{r}
lc_subset
lcc_subset
fisl_subset
```

```{r}
( climateNA_lc = lc_subset %>% 
  rename(id1 = ID, id2 = fireYr, long = lon) %>%
  relocate(id1, id2) 
)

```

```{r}
( climateNA_lcc = lcc_subset %>% 
  rename(id1 = ID, id2 = fireYr, long = lon) %>%
  relocate(id1, id2) 
)

```

```{r}
( climateNA_fisl = fisl_subset %>% 
  rename(id1 = ID, id2 = fireYr, long = lon) %>%
  relocate(id1, id2) 
)

```
```{r}
write_csv(climateNA_lc, "../outputs/LCC_cleaned/csv/2025-06-02_climateNA_LC.csv")
write_csv(climateNA_lcc, "../outputs/LCC_cleaned/csv/2025-06-02_climateNA_LCC.csv")
write_csv(climateNA_fisl, "../outputs/LCC_cleaned/csv/2025-06-02_climateNA_FISL.csv")
```


