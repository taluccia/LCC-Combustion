---
title: "Organize TWI"
author: "Anna Talucci"
date: "2025-08-21"
output: html_document
---




```{r clear environment, include=FALSE}
rm(list=ls())
```

# Overview

Combine revised terrain metrics


color help
http://vrl.cs.brown.edu/color

# Packages

```{r}
library(tidyverse)
```


# Data

## plot list

```{r}
org_plots = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_ORG_fullCombustionID.csv")
lc_plots = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_LC_fullCombustionID.csv")
lcc_plots = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_LCC_fullCombustionID.csv")
fisl_plots = read_csv("../outputs/LCC_cleaned/csv/2025-08-28_FISL_fullCombustionID.csv")
```

## TWI

```{r}
twi_list = list.files(path="../data/twi_utm_extracted", pattern='*.csv', full.names = TRUE)
```

## terrain metrics

```{r}
fisl = read_csv("../data/2025-08-08_combustion_layer_update/2025-08-18_terrainEE/2025-08-18TerrainMetrics_FISL.csv")
lc = read_csv("../data/2025-08-08_combustion_layer_update/2025-08-18_terrainEE/2025-08-18TerrainMetrics_LC.csv")
lcc = read_csv("../data/2025-08-08_combustion_layer_update/2025-08-18_terrainEE/2025-08-18TerrainMetrics_LCC.csv")
org = read_csv("../data/2025-08-08_combustion_layer_update/2025-08-18_terrainEE/2025-08-18TerrainMetrics_ORG.csv")
```

```{r}
mathes_twi_a = read_csv("../data/twi_csv_mathes/FABDEM_StaticTerrain_OldData_aboveground.csv")
mathes_twi_b = read_csv("../data/twi_csv_mathes/FABDEM_StaticTerrain_OldData_belowground.csv")
```

# Read and combine data frame list

```{r eval=FALSE, include=FALSE}
csv_rbind <- function(file_list) {
  csv_data <- purrr::map_dfr(file_list, read_csv)
  return(csv_data)
}

```

```{r}
csv_rbind <- function(file_list) {
  df <- file_list %>%
  map_dfr(~ read_csv(.x) %>%
            select(-any_of("fireYr")) %>%
            mutate(source_file = basename(.x)))
  return(df)
}
```


```{r}
( twi= csv_rbind(twi_list) )

```

```{r}
# Check duplicate ID
twi %>%
  group_by(ID) %>%
  filter(n() > 1) %>%
  ungroup()



```

## Split into projects

```{r}
unique(twi$prjct_n)
```


```{r}
( twi_clean = twi %>% select(ID, b1, prjct_n) %>% rename(twi=b1, project_name = prjct_n) )
```


```{r}
( fisl_twi = twi_clean %>% filter(project_name=="FISL") %>% distinct(ID, .keep_all = TRUE))
( lc_twi = twi_clean %>% filter(project_name=="LC") %>% distinct(ID, .keep_all = TRUE) )
( lcc_twi = twi_clean %>% filter(project_name=="LCC") %>% distinct(ID, .keep_all = TRUE) )
( org_twi = twi_clean %>% filter(project_name %in% c("NWT_BCKE", "NWT_MackWalker", "CAN_deGroot", "SK_RTJ", "JFSP_Boby", "AK_KT", "AK_Rogers", "Hoy_AK")) %>% distinct(ID, .keep_all = TRUE) )
```


```{r}
( lc_df = lc_plots %>% left_join(lc_twi, by="ID") %>% select(-project_name.y) %>% rename(project_name = project_name.x))
( lcc_df = lcc_plots %>% left_join(lcc_twi, by="ID") %>% select(-project_name.y) %>% rename(project_name = project_name.x))
( fisl_df = fisl_plots %>% left_join(fisl_twi, by="ID") %>% select(-project_name.y) %>% rename(project_name = project_name.x))
( org_df = org_plots %>% left_join(org_twi, by="ID") %>% select(-project_name.y) %>% rename(project_name = project_name.x))
```


# Check for missing data

```{r}
lc_df %>% filter(if_any(c(above.carbon.combusted, below.ground.carbon.combusted, burn.depth, twi), is.na))
fisl_df %>% filter(if_any(c(above.carbon.combusted, below.ground.carbon.combusted, burn.depth, twi), is.na))
lcc_df %>% filter(if_any(c( twi), is.na))
org_df %>% filter(if_any(c(above.carbon.combusted, below.ground.carbon.combusted, burn.depth, twi), is.na))
```